<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="../css/main.css">
        <title>Stable Stabler - Highscores</title>
    </head>
    <body>
        <main>
            <h1 class="headline">Highscores</h1>
            <p class="subtitle">Look at these master builders</p>
            
            <div id="highscore-list">
                <p>Loading highscores...</p>
            </div>
        </main>

        <script>
            async function getHighscores() {
                try {
                    const response = await fetch(`{{VITE_BASE_API_URL}}/highscore?mode=singleplayer`, {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json"
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        displayHighscores(data);
                    } else {
                        console.error("Failed to get highscores");
                        document.getElementById('highscore-list').innerHTML = '<p>Failed to load highscores</p>';
                    }
                } catch (error) {
                    console.error("Error while getting highscores:", error);
                    document.getElementById('highscore-list').innerHTML = '<p>Error loading highscores</p>';
                }
            }

            function displayHighscores(highscores) {
                const container = document.getElementById('highscore-list');
                
                if (!highscores || highscores.length === 0) {
                    container.innerHTML = '<p>No highscores yet!</p>';
                    return;
                }

                // Sort highscores by score (highest first)
                const sortedScores = highscores.sort((a, b) => b.score - a.score);
                const topTen = sortedScores.slice(0,10)

                let html = '<table class="highscore-table">';
                topTen.forEach((score, index) => {
                    html += `
                        <tr class="highscore-entry">
                            <th class="rank">${index + 1}.</th>
                            <th class="player">${score.player || 'Anonymous'}</th>
                            <th class="score">${score.score}</th>
                        </tr>
                    `;
                });
                html += '</table>';

                container.innerHTML = html;
            }

            // Load highscores when page loads
            document.addEventListener('DOMContentLoaded', getHighscores);
        </script>
    </body>
</html>