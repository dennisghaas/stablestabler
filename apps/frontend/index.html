<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Stable Stabler</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style>
      *,
      *::before,
      *::after {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      html, body {
          width: 100%;
          height: 100%;
      }

      body {
          line-height: 1;
          font-family: Arial, sans-serif;
          background-color: white;
      }

      ol, ul {
          list-style: none;
      }

      img, video {
          max-width: 100%;
          height: auto;
          display: block;
      }

      a {
          text-decoration: none;
          color: inherit;
      }
  </style>
</head>
<body>

<script type="text/javascript">
    const width = window.innerWidth;
    const height = window.innerHeight;

    const centerX = width * 0.5;

    const config = {
        type: Phaser.AUTO,
        width: width,
        height: height,
        physics: {
        default: 'matter',
        matter: {
            gravity: { y: 1 },
            debug: true // Remove debug: true in production!
        }
    },
        scene: {
            preload: preload,
            create: create,
            update: update
        },
        input: {
        keyboard: true
    },
    };

    const game = new Phaser.Game(config);

    let crane
    let craneSpeed = 0.02; // pixels per frame
    let time = 0;

    let boundaries;
    let ground;

    let buildingBlocks;

    let keyPressed = false;

    function preload ()
    {
      //Load assets
      this.load.image('crane', 'assets/png/crane.png');
      this.load.image('redBlockTexture', 'assets/png/block-red.png');
      this.load.image('redBlockStartTexture', 'assets/png/start-block-red.png');

      this.load.on('loaderror', function (file) {
        console.error('Failed to load:', file.src);
    });
    }

    function create ()
    {
      //Set World boundaries
      boundaries = this.matter.world.setBounds(0, 0, width, height);

      //Create crane
      crane = this.matter.add.image(centerX, 34, 'crane');
      crane.setStatic(true)
      crane.body.label = 'crane';

      // Create ground (static body)
      this.add.graphics()
        .fillStyle(0xA52A2A)  // Brown color
        .fillRect(0, 0, width, 40)
        .generateTexture('groundTexture', width, 40)
        .destroy();

      let ground = this.matter.add.image(width/2, height - 20, 'groundTexture', null, 
                    {   
                      isStatic: true 
                    });

      //Create ground floor
      let groundFloor = this.matter.add.image(
              width/2, height-160,
              'redBlockStartTexture', null, 
              {
                isStatic: true
              }
              )
              .setScale(0.4)
      groundFloor.body.label = 'groundFloor';

      //Handle collisions
      this.matter.world.on('collisionstart', function (event) {
        event.pairs.forEach(function (pair) {
            const { bodyA, bodyB } = pair;
            
            // Check if one of the bodies is a boundary
            if (bodyA.isStatic && bodyA.label === 'Rectangle Body' && !bodyB.isStatic) {
                console.log('BoxA touched boundary!', bodyB.position, {bodyB});
                game.destroy();
            } 
        });
      });
    }

    function update ()
    {
      //Move crane
      const centerXMovement = width * 0.5;
      const moveRange = width * 0.25;

      time += craneSpeed;
      crane.x = centerXMovement + Math.sin(time) * moveRange;

      //Handle spacebar input
      const spacBar = this.input.keyboard.addKey("SPACE")
      if(spacBar.isDown){
          if(!keyPressed){
              const position = crane.x;
              this.matter.add.image(
                position, 200,
                'redBlockTexture'
              )
              .setScale(0.4)
              .setBounce(0)
              .setFriction(1);
              keyPressed = true
          }
      }

      if(spacBar.isUp){
          keyPressed = false
      }
    }

</script>

</body>
</html>